  ---
title: "Profiling Household Energy Consumption"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Instructions from Karen:
- Get best prediction
  - Try different complexity of models
- What is most important factors
  - ranking
    - split by total and by KWH and NG
- How can we reduce energy consumption
- Constrained optimization (given some factors that can't change how can we optimize energy consumption)

## Abstract
Understanding the nation's energy usage patterns is critical to building a sustainable infrastructure. Identifying areas of waste and opportunities to implement resource-saving practices could drastically reduce the cost of various energy types. In our analysis, we will look at the profiles of approximately 5,000 households to identify patterns related to the usage of electriciy and natural gas. From this data, we will recommend ways homeowners and landlords can reduce energy consumption. Additionally, we'll examine the feasability of predicting energy consumption given information about a household.

## Introduction
Energy usage in US households consists primarily of electricity and natural gas, but the usage of these resources varies significantly.

## Method and Result

### Data Preparation
Describe our data set and where it comes from
#### Removing Columns
We opted to remove variables in the data set when half or more of the values were missing. Many of these fields we removed had less than 10% of the data present. Given the high dimensionality of our data set, we felt that variables with too few observations would erroneously impact our analysis.

#### Accounting for Missing Data
Of those fields that remained, we filled in missing values by sampling from the distribution of existing values. This approach maintains the shape of our original distributions and allows us to use all our observations.

### Feature Selection
How much energy a household uses is a complex matter: it is determined by many variables. We want to identify which aspects of the homes and the homeowners contribute the most to their energy use. By focusing our efforts on the most impactful factors, we can identify which changes could potentially yield the best results.

#### Recursive Feature Elimination
Recursive Feature Elimination (RFE) is a method of identifying the most valuable features by building many models with all the variables and removing those that have little reduction to the total error. Running this method on our input data, we can see that there are several key features that explain much of the variance, and that a majority of the features contribute only a little. We used 10-fold validation on RFE to avoid over-fitting our results.

![RFE](feature_count_vs_error.png)

And now if we zoom in, we can see our most useful variables:

![Top Features](impactful_variables.png)

| Variable | Description                                       | Root Mean Squared Error |
| -------- | ------------------------------------------------- | ----------------------: |
| NHSLDMEM | Number that live in the household                 | 0.1035                  |
| TYPEHUQ  | Type of home (e.g. single-family, apartment, etc) | 0.2412                  |
| HD65     | Number of hot days                                | 0.3515                  |
| TOTHSQFT | Total home square feet                            | 0.3958                  |
| TOTSQFT  | Total square feet                                 | 0.4165                  |
| LRGSTATE | Is a large state (i.e. CA, FL, NY, TX)            | 0.4151                  |

Our results show that the number of household members contributed the most to reducing the error in our model. This is likely due to the more frequent usage of appliances by household members. The other findings are pretty self evident. The type of home is typically associated with square footage. The number of hot days clearly would be related to how much AC would be required to stay cool. Square footage is obviously related with how much heating/cooling is required.

The large states; however, have more to do with geography and less to do with population. The graph below shows KWH usage by state. And as can be expected the lower/warmer states use more electricity for cooling their homes.

![KWH by state](KWH_Use_by_State.png)

(If we plot usage of natural gas by state, the trend is simply reversed)


#### Principle Component Analysis
Another way to understand the impact our variables have on energy usage is to examine how the variables interact with each other. We can do this through Principle Component Analysis (PCA). With PCA we convert the variables into Principle Components. These components are a weighted combination of many variables, which captures the interplay amongst these variables. They are arranged by how much each component contributes to the variance.

So, principle component 1 (PC1) explains the most about our energy usage, PC2 the second most, and so on. We can see in the graph below that our most explanatory component (PC1) is square footage, and it's opposite is the type of home (TYPEHUQ), with higher category number typically denoting smaller home types (e.g. apartments). This finding is intuitive. Larger homes take more energy to regulate temperature, and smaller homes require less.

![Top 2 component interactions](biplot_pca1_pca2.png)

Principle Component 2 (PC2), however, reveals an interesting finding. It appears that older persons tend to use less energy. We can see that the older the primary owner is (AGEHHMEM1) and if they are in retirement (RETIREPY) as associated with less energy consumption. And on the flip side we see that those who are working (WORKPAY) and have more people at home (NHSLDMEM) (e.g. young families) use more energy. One hypothesis is that older persons are more experienced with home ownership. They have more years of home ownership and have thus optimized the heating/cooling of their homes to reduce costs. An alternative hypothesis is that older people tend to be home bound. This can also be seen in the above graph by the ATHOME variable, which means that at least 1 person is home all day on a typical weekday. While being at home all day, older people can keep a closer tab on their heating and cooling, whereas younger individuals and families leave their home more frequently for work, school, and shopping, and often forget to adjust their heating/cooling accordingly.

### Classification
Adjusting our SD threshold for improved accuracy on high and low
Comparing classifier accuracy
Output of best predictor

### Reducing Error with Linear Model


## Conclusion and Further Work
Alan - I'm guessing that people leaving the home is a primary cause of energy waste, which is why many energy companies offer rebates for smart thermometers, and why old people have lower energy usage rates (they're at home more often)


## Takeaways
This project did a great job of demonstrating the reality of real world datasets compared to the preprocessed examples that students are accustomed to working with. Real data sets are messy. Real data sets don't always have that one obvious correlation. There is a lot of noise and a lot of missing data. Given this new perspective, we will allocate more time to understanding the variables and dealing with missing values.

Another thing that we would do differently on future projects is to spend more time on gathering client requirements. We charged gung ho ahead with our new-found data mining skills and spent significant time implementing many of the techniques only to realize they might not be very useful given our client's requirements. After having a brief discussion with the client to clarify expectations, we had a well defined plan of action. Doing this earlier would have saved us considerable time.
